(()=>{var e={961:(e,t,n)=>{var r,o=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var i={compressToBase64:function(e){if(null==e)return"";var n=i._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,(function(n){return o(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":i._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=i.compress(e),n=new Uint8Array(2*t.length),r=0,o=t.length;r<o;r++){var s=t.charCodeAt(r);n[2*r]=s>>>8,n[2*r+1]=s%256}return n},decompressFromUint8Array:function(t){if(null==t)return i.decompress(t);for(var n=new Array(t.length/2),r=0,o=n.length;r<o;r++)n[r]=256*t[2*r]+t[2*r+1];var s=[];return n.forEach((function(t){s.push(e(t))})),i.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,(function(t){return o(n,e.charAt(t))})))},compress:function(t){return i._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var r,o,i,s={},a={},c="",u="",l="",d=2,p=3,f=2,h=[],m=0,g=0;for(i=0;i<e.length;i+=1)if(c=e.charAt(i),Object.prototype.hasOwnProperty.call(s,c)||(s[c]=p++,a[c]=!0),u=l+c,Object.prototype.hasOwnProperty.call(s,u))l=u;else{if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(r=0;r<f;r++)m<<=1,g==t-1?(g=0,h.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<f;r++)m=m<<1|o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}0==--d&&(d=Math.pow(2,f),f++),delete a[l]}else for(o=s[l],r=0;r<f;r++)m=m<<1|1&o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o>>=1;0==--d&&(d=Math.pow(2,f),f++),s[u]=p++,l=String(c)}if(""!==l){if(Object.prototype.hasOwnProperty.call(a,l)){if(l.charCodeAt(0)<256){for(r=0;r<f;r++)m<<=1,g==t-1?(g=0,h.push(n(m)),m=0):g++;for(o=l.charCodeAt(0),r=0;r<8;r++)m=m<<1|1&o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}else{for(o=1,r=0;r<f;r++)m=m<<1|o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)m=m<<1|1&o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o>>=1}0==--d&&(d=Math.pow(2,f),f++),delete a[l]}else for(o=s[l],r=0;r<f;r++)m=m<<1|1&o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o>>=1;0==--d&&(d=Math.pow(2,f),f++)}for(o=2,r=0;r<f;r++)m=m<<1|1&o,g==t-1?(g=0,h.push(n(m)),m=0):g++,o>>=1;for(;;){if(m<<=1,g==t-1){h.push(n(m));break}g++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,r){var o,i,s,a,c,u,l,d=[],p=4,f=4,h=3,m="",g=[],v={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)d[o]=o;for(s=0,c=Math.pow(2,2),u=1;u!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),s|=(a>0?1:0)*u,u<<=1;switch(s){case 0:for(s=0,c=Math.pow(2,8),u=1;u!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),s|=(a>0?1:0)*u,u<<=1;l=e(s);break;case 1:for(s=0,c=Math.pow(2,16),u=1;u!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),s|=(a>0?1:0)*u,u<<=1;l=e(s);break;case 2:return""}for(d[3]=l,i=l,g.push(l);;){if(v.index>t)return"";for(s=0,c=Math.pow(2,h),u=1;u!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),s|=(a>0?1:0)*u,u<<=1;switch(l=s){case 0:for(s=0,c=Math.pow(2,8),u=1;u!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),s|=(a>0?1:0)*u,u<<=1;d[f++]=e(s),l=f-1,p--;break;case 1:for(s=0,c=Math.pow(2,16),u=1;u!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=r(v.index++)),s|=(a>0?1:0)*u,u<<=1;d[f++]=e(s),l=f-1,p--;break;case 2:return g.join("")}if(0==p&&(p=Math.pow(2,h),h++),d[l])m=d[l];else{if(l!==f)return null;m=i+i.charAt(0)}g.push(m),d[f++]=i+m.charAt(0),i=m,0==--p&&(p=Math.pow(2,h),h++)}}};return i}();void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)},680:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.find=function(e,t){var n=t.querySelector(e.s);if(!n)throw new Error("Unable to find element with selector: "+e.s);return n.childNodes[e.c]},t.generateSelector=function(e,n){var r=e,o=[],i=0;if(e.parentNode)for(i=t.childNodeIndexOf(e.parentNode,e);r;){var s=r.tagName;if(s){var a=t.computedNthIndex(r),c=s;a>1&&(c+=":nth-of-type("+a+")"),o.push(c)}if((r=r.parentNode||r.parentElement)==(n.parentNode||n.parentElement))break}return{s:o.reverse().join(">").toLowerCase(),c:i,o:0}},t.childNodeIndexOf=function(e,t){for(var n=e.childNodes,r=0,o=0,i=n.length;o<i;o++)if(n[o]===t){r=o;break}return r},t.computedNthIndex=function(e){var t=0,n=e.parentNode||e.parentElement;if(n)for(var r=0,o=n.childNodes.length;r<o;r++){var i=n.childNodes[r];if(i===e){t++;break}i.tagName===e.tagName&&t++}return t}},967:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(961));t.compress=function(e){return o.default.compressToUint8Array(e)},t.decompress=function(e){return o.default.decompressFromUint8Array(e)}},114:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.encode=function(e){return btoa(Array.prototype.map.call(e,(function(e){return String.fromCharCode(e)})).join(""))},t.decode=function(e){var t=atob(e),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,(function(e,t){return n[t]=e.charCodeAt(0)})),n}},774:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(680);t.serialize=function(e,t){var n=r.generateSelector(e.startContainer,t);n.o=e.startOffset;var o=r.generateSelector(e.endContainer,t);return o.o=e.endOffset,{s:n,e:o}},t.deserialize=function(e,t){var n=t.createRange(),o=r.find(e.s,t),i=r.find(e.e,t);return o.nodeType!=Node.TEXT_NODE&&o.firstChild&&(o=o.firstChild),i.nodeType!=Node.TEXT_NODE&&i.firstChild&&(i=i.firstChild),o&&n.setStart(o,e.s.o),i&&n.setEnd(i,e.e.o),n}},674:(e,t,n)=>{"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0});var o=n(774),i=n(967),s=n(114);t.Rangee=function(e){var t=this;this.onSerialization=function(e){return t.serializationCallback=e},this.onCompression=function(e){return t.compressionCallback=e},this.serializeAtomic=function(e){var n=t.createAtomicRanges(e).map((function(e){return o.serialize(e.cloneRange(),t.options.document.body)})).map((function(e){return JSON.stringify(e)})).join("|");t.serializationCallback&&t.serializationCallback(n);var r=i.compress(n);return t.compressionCallback&&t.compressionCallback(r),s.encode(r)},this.deserilaizeAtomic=function(e){var n=s.decode(e);return i.decompress(n).split("|").map((function(e){return JSON.parse(e)})).reverse().map((function(e){return o.deserialize(e,t.options.document)}))},this.serialize=function(e){var n=o.serialize(e.cloneRange(),t.options.document.body),r=JSON.stringify(n),a=i.compress(r);return s.encode(a)},this.deserialize=function(e){var n=s.decode(e),r=i.decompress(n),a=JSON.parse(r);return o.deserialize(a,t.options.document)},this.createAtomicRanges=function(e){if(e.startContainer===e.endContainer&&e.startContainer.nodeType===Node.TEXT_NODE)return[e];for(var n,r=t.options.document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ALL,(function(e){return NodeFilter.FILTER_ACCEPT}),!1),o=!1,i=!1,s=[];n=r.nextNode();){if(n===e.startContainer&&(o=!0),n.nodeType===Node.TEXT_NODE&&o&&!i&&n.textContent&&n.textContent.trim().length>0){var a=t.options.document.createRange();a.setStart(n,n===e.startContainer?e.startOffset:0),a.setEnd(n,n===e.endContainer?e.endOffset:n.length),s.push(a)}n===e.endContainer&&(i=!0)}return s},this.options=e,this.serializationCallback=null,this.compressionCallback=null},r(n(680)),r(n(967)),r(n(114)),r(n(774))}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(()=>{"use strict";const e=new(n(674).Rangee)({document});function t(e){const t=[],n=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT);for(;n.nextNode();){const o=n.currentNode;r(o,e)&&t.push(o)}0===t.length&&e.commonAncestorContainer.nodeType===Node.TEXT_NODE&&t.push(e.commonAncestorContainer),t.forEach((t=>{const n=document.createElement("span");n.style.backgroundColor="yellow";const r=document.createRange();r.selectNodeContents(t),function(e,t){const n=e.cloneRange();return n.setStart(t.startContainer,t.startOffset),n.setEnd(t.endContainer,t.endOffset),n}(r,e).surroundContents(n)}))}function r(e,t){const n=document.createRange();return n.selectNodeContents(e),t.compareBoundaryPoints(Range.END_TO_START,n)<=0&&t.compareBoundaryPoints(Range.START_TO_END,n)>=0}chrome.runtime.onMessage.addListener(((n,r,o)=>{if("websiteHighlights"===n.type){const r=n.data;console.log("Recieved websiteHighlights: ",r),r.forEach((n=>{const r=e.deserilaizeAtomic(n.serializedRange);console.log("deserialized range: ",r),r&&r.forEach((e=>{t(e)}))}))}})),document.addEventListener("mouseup",(function(){const n=window.getSelection();if(n&&n.toString().length>0){const r=n.getRangeAt(0),o=n.toString(),i=window.location.href;console.log("Selected Text:",o),console.log("Website URL:",i),console.log("Range selected: ",r);const s={url:i,serializedRange:e.serializeAtomic(r)};chrome.runtime.sendMessage({type:"newHighlight",data:s}),t(r),n.removeAllRanges()}}))})()})();